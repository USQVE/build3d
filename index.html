<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Worldsmith - AI Creation Sandbox</title>

    <script type="importmap">
      {
        "imports": {
          "three": "https://esm.sh/three@0.160.0?dev",
          "three/": "https://esm.sh/three@0.160.0&dev/",
          "three/addons/": "https://esm.sh/three@0.160.0&dev/addons/"
        }
      }
    </script>

    <style>
      :root{
        --panel-bg: rgba(44,62,80,0.95);
        --panel-opacity: 1;
        --panel-scale: 1;
      }
      @media (prefers-reduced-motion: reduce){
        *{ transition: none !important; animation: none !important; }
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
        background: #2c3e50;
      }

      #gameContainer { position: relative; width: 100vw; height: 100vh; }
      canvas { display: block; }

      /* Panels (use vars) */
      #libraryPanel, #propertiesPanel, #consolePanel{
        background: var(--panel-bg);
        opacity: var(--panel-opacity);
        transform: scale(var(--panel-scale));
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        color: #fff;
        border-radius: 12px;
        padding: 20px;
        font-size: 14px;
        z-index: 1000;
      }
      #libraryPanel, #propertiesPanel{
        position: absolute; top: 20px; max-height: calc(100vh - 140px);
        overflow-y: auto; width: clamp(240px, 18vw, 320px);
      }
      #libraryPanel { left: 20px; }
      #propertiesPanel { right: 20px; }

      #consolePanel{
        position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
        width: clamp(320px, 52vw, 720px); z-index: 1000;
        opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
      }
      #consolePanel.show { opacity: 1; pointer-events: auto; }

      #title{
        position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
        color: #fff; font-size: 24px; font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5); z-index: 999;
        transition: opacity 0.5s ease; pointer-events: none;
      }
      .immersive-mode #title.fade-out { opacity: 0; }

      .panel-section{ margin-bottom: 20px; }
      .panel-section h3{
        margin-bottom: 10px; color: #3498db; font-size: 16px;
        border-bottom: 1px solid rgba(52,152,219,0.3); padding-bottom: 5px;
      }
      .category-grid{ display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 15px; }
      .category-btn{
        padding: 10px; border: 0; border-radius: 8px; cursor: pointer; font-size: 12px;
        background: rgba(52,152,219,0.3); color: #fff; transition: .2s; text-align: center;
      }
      .category-btn:hover{ background: rgba(52,152,219,0.6); transform: scale(1.05); }
      .category-btn.active{ background: #3498db; transform: scale(0.95); }

      .input-group{ display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
      .input-group label{ min-width: 60px; font-size: 12px; color: #bdc3c7; }
      .input-group input,.input-group select{
        flex: 1; padding: 8px; border: 0; border-radius: 6px; background: rgba(255,255,255,0.1); color: #fff; font-size: 12px;
      }
      .input-group input::placeholder{ color: rgba(255,255,255,0.5); }

      #commandInput{
        width: 100%; padding: 15px; border: 0; border-radius: 8px;
        background: rgba(255,255,255,0.1); color: #fff; font-size: 16px; margin-bottom: 15px;
      }
      #commandInput::placeholder{ color: rgba(255,255,255,0.6); }

      .console-buttons{ display: flex; gap: 10px; align-items: center; }
      .action-btn{
        padding: 12px 20px; border: 0; border-radius: 8px; background: #27ae60; color: #fff;
        cursor: pointer; font-size: 14px; transition: background .2s; font-weight: 700;
      }
      .action-btn:hover{ background: #229954; }
      .action-btn.secondary{ background: #34495e; }
      .action-btn.secondary:hover{ background: #2c3e50; }
      .action-btn.danger{ background: #e74c3c; }
      .action-btn.danger:hover{ background: #c0392b; }

      #rosieResponse{
        background: rgba(46,204,113,.1); border: 1px solid rgba(46,204,113,.3);
        border-radius: 8px; padding: 12px; margin-top: 15px; color: #2ecc71; font-size: 14px;
        min-height: 20px; display: none;
      }

      /* Perf HUD */
      #performanceStats{
        position: absolute; top: 20px; left: 20px;
        background: rgba(0,0,0,0.7); color: #fff; padding: 8px 12px;
        border-radius: 6px; font-size: 11px; font-family: monospace;
        z-index: 1001; transition: opacity .3s ease; pointer-events: none;
      }
      .hide-hud #performanceStats { opacity: 0; }

      /* Immersive mode */
      .immersive-mode #libraryPanel,
      .immersive-mode #propertiesPanel{ opacity: 0; pointer-events: none; transition: all .3s ease; }
      
      /* Console always visible */
      #consolePanel{ opacity: 1; pointer-events: auto; }

      /* Crosshair */
      #crosshair{
        position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; transform: translate(-50%,-50%);
        pointer-events: none; z-index: 1000; opacity: 0; transition: opacity .3s ease;
      }
      #crosshair::before,#crosshair::after{ content:''; position: absolute; background: rgba(255,255,255,.8); }
      #crosshair::before{ width: 2px; height: 8px; left: 50%; top: 50%; transform: translate(-50%,-50%); }
      #crosshair::after{ width: 8px; height: 2px; left: 50%; top: 50%; transform: translate(-50%,-50%); }
      .immersive-mode #crosshair{ opacity: 1; }

      /* Edge tabs */
      .edge-tab{
        position: fixed; background: rgba(44,62,80,.9); color: #fff; padding: 15px 8px;
        border-radius: 0 8px 8px 0; cursor: pointer; font-size: 18px; z-index: 1002;
        user-select: none; writing-mode: vertical-rl; text-orientation: mixed;
        transition: all .3s ease; opacity: 0; pointer-events: none;
      }
      .edge-tab:hover{ background: rgba(52,152,219,.9); transform: translateX(5px); }
      .edge-tab:focus{ outline: 2px solid #3498db; transform: translateX(5px); }
      #libraryTab{ top: 50%; left: 0; transform: translateY(-50%); }
      #propertiesTab{ top: 50%; right: 0; transform: translateY(-50%); border-radius: 8px 0 0 8px; }
      #propertiesTab:hover{ transform: translateY(-50%) translateX(-5px); }
      .immersive-mode .edge-tab{ opacity: 1; pointer-events: auto; }

      /* Hover reveal */
      .immersive-mode #libraryPanel:hover,
      .immersive-mode #propertiesPanel:hover,
      .immersive-mode #libraryPanel.force-show,
      .immersive-mode #propertiesPanel.force-show{
        opacity: .3; pointer-events: auto; transform: scale(.8);
        transform-origin: top left;
      }
      .immersive-mode #propertiesPanel:hover,
      .immersive-mode #propertiesPanel.force-show{ transform-origin: top right; }

      /* Control hints - removed, keeping HUD minimal */
      #hudElements{ position: absolute; inset: 0; pointer-events: none; z-index: 1001; transition: opacity .3s ease; }
      #controlHints{ display: none; }

      /* Command palette */
      #commandPalette{
        position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
        width: 500px; max-height: 400px; background: rgba(44,62,80,.95);
        border-radius: 12px; padding: 20px; z-index: 2000; backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0,0,0,.5); opacity: 0; pointer-events: none; transition: all .3s ease; color: #fff;
      }
      #commandPalette.show{ opacity: 1; pointer-events: auto; }
      #commandPalette h3{ margin-bottom: 15px; color: #3498db; }
      .palette-item{ padding: 10px; margin: 5px 0; border-radius: 6px; cursor: pointer; transition: background .2s; display:flex; justify-content:space-between; align-items:center; }
      .palette-item:hover{ background: rgba(52,152,219,.3); }
      .palette-shortcut{ font-size: 11px; color: #bdc3c7; font-family: monospace; }
      /* Compact UI Dock */
      #uiControls{
        position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: row; gap: 8px;
        z-index: 1002; opacity: 0; pointer-events: none; transition: all 0.3s ease;
      }
      #uiControls.show { opacity: 1; pointer-events: auto; }
      .ui-control-btn{
        width: 36px; height: 36px; background: rgba(44,62,80,0.9); border: none;
        border-radius: 50%; color: #fff; font-size: 14px; font-weight: 400; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: all .2s ease;
        backdrop-filter: blur(10px); position: relative; opacity: 0.6;
      }
      .ui-control-btn:hover{ opacity: 1; transform: scale(1.1); }
      .ui-control-btn:active{ transform: scale(0.9); }
      .ui-control-btn.active::after{
        content: ''; position: absolute; inset: -2px; border: 2px solid rgba(46,204,113,0.8);
        border-radius: 50%; animation: pulse-ring 2s infinite;
      }
      @keyframes pulse-ring {
        0% { transform: scale(1); opacity: 0.8; }
        50% { transform: scale(1.1); opacity: 0.4; }
        100% { transform: scale(1); opacity: 0.8; }
      }
      /* Toast Notifications */
      #toastContainer{
        position: fixed; top: 80px; right: 20px; z-index: 2001; display: flex; flex-direction: column; gap: 8px;
      }
      .toast{
        background: rgba(46,204,113,0.95); color: #fff; padding: 12px 16px; border-radius: 8px;
        font-size: 14px; font-weight: 500; backdrop-filter: blur(10px); box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        transform: translateX(100%); opacity: 0; transition: all .3s ease; max-width: 250px;
      }
      .toast.show{ transform: translateX(0); opacity: 1; }
      .toast.success{ background: rgba(46,204,113,0.95); }
      .toast.info{ background: rgba(52,152,219,0.95); }
      .toast.warning{ background: rgba(241,196,15,0.95); }
      /* Quick peek panels */
      .quick-peek{
        opacity: 0.3 !important; pointer-events: auto !important; transform: scale(0.9) !important;
      }
      #libraryPanel.quick-peek{ transform-origin: top left; }
      #propertiesPanel.quick-peek{ transform-origin: top right; }
      /* Console always visible - remove temporary styling */
      /* Recording widget */
      #recordingWidget {
        position: fixed; top: 20px; left: 20px; background: rgba(220,53,69,0.9);
        color: #fff; padding: 8px 12px; border-radius: 20px; font-size: 11px;
        font-family: monospace; z-index: 1001; opacity: 0; pointer-events: none;
        transition: opacity 0.3s ease; display: flex; align-items: center; gap: 8px;
      }
      #recordingWidget.show { opacity: 1; }
      #recordingWidget::before {
        content: '●'; color: #ff4444; font-size: 12px; animation: blink 1s infinite;
      }
      @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.3; } }
      
      /* Hide UI controls in screenshots */
      .screenshot-mode #uiControls,
      .screenshot-mode #toastContainer,
      .screenshot-mode #recordingWidget,
      .screenshot-mode #libraryPanel,
      .screenshot-mode #propertiesPanel,
      .screenshot-mode #consolePanel,
      .screenshot-mode #title,
      .screenshot-mode #performanceStats,
      .screenshot-mode .edge-tab { display: none !important; }
      /* Low-spec fallback */
      .low-spec #libraryPanel, .low-spec #propertiesPanel, .low-spec #consolePanel{
        backdrop-filter: none; box-shadow: 0 4px 16px rgba(0,0,0,.25);
      }
      
      /* Category items styling */
      .category-items { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .item-btn {
        padding: 8px; border: 0; border-radius: 6px; cursor: pointer; font-size: 11px;
        background: rgba(46,204,113,0.2); color: #fff; transition: .2s; text-align: center;
        position: relative;
      }
      .item-btn:hover { background: rgba(46,204,113,0.4); transform: scale(1.02); }
      .item-btn:active { transform: scale(0.98); }
      .item-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
      
      /* Preset picker modal */
      #presetPicker {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: rgba(44,62,80,0.95); border-radius: 8px; padding: 15px;
        z-index: 2001; opacity: 0; pointer-events: none; transition: all 0.2s ease;
        backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        min-width: 200px; color: #fff;
      }
      #presetPicker.show { opacity: 1; pointer-events: auto; }
      #presetPicker h4 { margin: 0 0 10px 0; color: #3498db; font-size: 14px; }
      .preset-option {
        padding: 8px 12px; margin: 4px 0; background: rgba(52,152,219,0.2);
        border: 0; border-radius: 4px; color: #fff; cursor: pointer; width: 100%;
        font-size: 12px; transition: background 0.2s;
      }
      .preset-option:hover { background: rgba(52,152,219,0.4); }
      
      /* Command bar highlight when prefilled */
      #commandInput.prefilled {
        background: rgba(46,204,113,0.15); border: 2px solid rgba(46,204,113,0.3);
        animation: prefillPulse 0.5s ease;
      }
      @keyframes prefillPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
      }
      
      /* Diagnostics panel */
      #diagnosticsPanel {
        position: fixed; bottom: 20px; left: 20px; background: rgba(44,62,80,0.95);
        color: #fff; padding: 15px; border-radius: 8px; font-size: 11px;
        font-family: monospace; z-index: 1002; opacity: 0; pointer-events: none;
        transition: opacity 0.3s ease; max-width: 300px; backdrop-filter: blur(10px);
      }
      #diagnosticsPanel.show { opacity: 1; pointer-events: auto; }
      #diagnosticsPanel h4 { margin: 0 0 10px 0; color: #3498db; font-size: 12px; }
      .diagnostic-item { margin: 2px 0; }
      .diagnostic-actions { margin-top: 10px; }
      .diagnostic-btn { 
        padding: 4px 8px; margin-right: 5px; background: #3498db; border: none;
        border-radius: 4px; color: #fff; font-size: 10px; cursor: pointer;
      }
      .diagnostic-btn:hover { background: #2980b9; }
    </style>
  </head>

  <body>
    <div id="gameContainer">
      <div id="title">Worldsmith — Creator Sandbox</div>
      <div id="crosshair" aria-hidden="true"></div>

      <!-- HUD -->
      <div id="hudElements">
        <div id="performanceStats">
          FPS: <span id="fps">60</span><br>
          Objects: <span id="objectCount">0</span><br>
          Triangles: <span id="triangleCount">0</span>
        </div>

        <!-- Recording widget -->
        <div id="recordingWidget">
          <span id="recordingTime">00:00</span>
        </div>
      </div>

      <!-- Edge Tabs -->
      <div id="libraryTab" class="edge-tab" title="Library (F1)" tabindex="0" aria-label="Open Library">📚</div>
      <div id="propertiesTab" class="edge-tab" title="Properties (F2)" tabindex="0" aria-label="Open Properties">🎛️</div>

      <!-- Library Panel -->
      <div id="libraryPanel">
        <div class="panel-section">
          <h3>📚 Object Library</h3>
          <div class="category-grid">
            <button class="category-btn active" data-category="environment" title="Terrain, water, sky, lighting">🌍 Environment</button>
            <button class="category-btn" data-category="buildings"   title="Houses, walls, doors, windows">🏠 Buildings</button>
            <button class="category-btn" data-category="vegetation"  title="Trees, grass, bushes, flowers">🌲 Vegetation</button>
            <button class="category-btn" data-category="props"       title="Furniture, tools, decorations">📦 Props</button>
            <button class="category-btn" data-category="npcs"        title="Characters with AI behavior">👥 NPCs</button>
            <button class="category-btn" data-category="vehicles"    title="Cars, boats, planes">🚗 Vehicles</button>
            <button class="category-btn" data-category="fx"          title="Particles, sounds, effects">✨ FX</button>
          </div>
        </div>

        <div class="panel-section" id="categoryItems">
          <div id="environmentItems" class="category-items">
            <button class="item-btn" data-category="environment" data-item="terrain" title="Create hills and valleys">🏔️ Terrain</button>
            <button class="item-btn" data-category="environment" data-item="water" title="Add rivers and lakes">🌊 Water</button>
            <button class="item-btn" data-category="environment" data-item="sky" title="Change time of day">☀️ Sky</button>
            <button class="item-btn" data-category="environment" data-item="weather" title="Add weather effects">🌧️ Weather</button>
          </div>
          
          <div id="buildingsItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="buildings" data-item="house" title="Create houses and buildings">🏠 House</button>
            <button class="item-btn" data-category="buildings" data-item="wall" title="Build walls and barriers">🧱 Wall</button>
            <button class="item-btn" data-category="buildings" data-item="tower" title="Construct towers">🗼 Tower</button>
            <button class="item-btn" data-category="buildings" data-item="castle" title="Build castles">🏰 Castle</button>
          </div>
          
          <div id="vegetationItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="vegetation" data-item="tree" title="Add individual trees">🌳 Tree</button>
            <button class="item-btn" data-category="vegetation" data-item="forest" title="Create forests">🌲 Forest</button>
            <button class="item-btn" data-category="vegetation" data-item="grass" title="Add grass areas">🌱 Grass</button>
            <button class="item-btn" data-category="vegetation" data-item="flowers" title="Place flower patches">🌸 Flowers</button>
          </div>
          
          <div id="propsItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="props" data-item="table" title="Place tables">🪑 Table</button>
            <button class="item-btn" data-category="props" data-item="chair" title="Add chairs">💺 Chair</button>
            <button class="item-btn" data-category="props" data-item="lamp" title="Place lighting">💡 Lamp</button>
            <button class="item-btn" data-category="props" data-item="barrel" title="Add storage items">🛢️ Barrel</button>
          </div>
          
          <div id="npcsItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="npcs" data-item="guard" title="Spawn guard NPCs">👮 Guard</button>
            <button class="item-btn" data-category="npcs" data-item="villager" title="Add villagers">👤 Villager</button>
            <button class="item-btn" data-category="npcs" data-item="merchant" title="Place merchants">🧙 Merchant</button>
            <button class="item-btn" data-category="npcs" data-item="animal" title="Add animals">🐎 Animal</button>
          </div>
          
          <div id="vehiclesItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="vehicles" data-item="boat" title="Place boats">⛵ Boat</button>
            <button class="item-btn" data-category="vehicles" data-item="cart" title="Add carts">🛒 Cart</button>
            <button class="item-btn" data-category="vehicles" data-item="carriage" title="Place carriages">🚗 Carriage</button>
            <button class="item-btn" data-category="vehicles" data-item="wagon" title="Add wagons">🚚 Wagon</button>
          </div>
          
          <div id="fxItems" class="category-items" style="display: none;">
            <button class="item-btn" data-category="fx" data-item="torch" title="Add light sources">🔥 Torch</button>
            <button class="item-btn" data-category="fx" data-item="particles" title="Create particle effects">✨ Particles</button>
            <button class="item-btn" data-category="fx" data-item="smoke" title="Add smoke effects">💨 Smoke</button>
            <button class="item-btn" data-category="fx" data-item="magic" title="Magical effects">🪄 Magic</button>
          </div>
        </div>

        <div class="panel-section">
          <h3>⚡ Quick Actions</h3>
          <button class="action-btn secondary" id="quickScreenshot" aria-label="Screenshot">📸 Screenshot</button>
          <button class="action-btn secondary" id="quickSaveWorld" aria-label="Save world">💾 Save World</button>
          <button class="action-btn secondary" id="quickLoadWorld" aria-label="Load world">📁 Load World</button>
        </div>
      </div>

      <!-- Properties Panel -->
      <div id="propertiesPanel">
        <div class="panel-section">
          <h3>🎛️ Object Properties</h3>
          <div style="color:#7f8c8d;font-style:italic;text-align:center;padding:20px;">Select an object to edit its properties</div>

          <div id="objectProperties" style="display:none;">
            <div class="input-group"><label>Name:</label><input type="text" id="objName" placeholder="Object name"></div>

            <h4 style="color:#3498db;margin:15px 0 10px;">Transform</h4>
            <div class="input-group"><label>Pos X:</label><input type="number" id="posX" step="0.1" placeholder="0.0 m"></div>
            <div class="input-group"><label>Pos Y:</label><input type="number" id="posY" step="0.1" placeholder="0.0 m"></div>
            <div class="input-group"><label>Pos Z:</label><input type="number" id="posZ" step="0.1" placeholder="0.0 m"></div>
            <div class="input-group"><label>Rot X:</label><input type="number" id="rotX" step="1" placeholder="0°"></div>
            <div class="input-group"><label>Rot Y:</label><input type="number" id="rotY" step="1" placeholder="0°"></div>
            <div class="input-group"><label>Rot Z:</label><input type="number" id="rotZ" step="1" placeholder="0°"></div>
            <div class="input-group"><label>Scale:</label><input type="number" id="scale" step="0.1" min="0.1" placeholder="1.0"></div>

            <h4 style="color:#3498db;margin:15px 0 10px;">Material</h4>
            <div class="input-group"><label>Color:</label><input type="color" id="objColor" value="#ffffff"></div>

            <h4 style="color:#3498db;margin:15px 0 10px;">Physics</h4>
            <div class="input-group">
              <label>Type:</label>
              <select id="physicsType">
                <option value="static">Static</option>
                <option value="dynamic">Dynamic</option>
                <option value="kinematic">Kinematic</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Console -->
      <div id="consolePanel">
        <input id="commandInput" type="text"
               placeholder="Tell me what to create... 'build a wooden bridge 30m long over the river' or 'add pine forest on north side'">

        <div class="console-buttons" role="group" aria-label="Console actions">
          <button class="action-btn" id="executeBtn">✨ Create</button>
          <button class="action-btn secondary" id="undoBtn">↶ Undo</button>
          <button class="action-btn secondary" id="redoBtn">↷ Redo</button>
          <button class="action-btn danger" id="clearAllBtn">🗑️ Clear All</button>
        </div>

        <div id="rosieResponse" role="status" aria-live="polite">
          Rosie: I'm ready to help you create! Try asking me to build something specific.
        </div>
      </div>

      <!-- Command Palette -->
      <div id="commandPalette" role="dialog" aria-modal="true" aria-label="Command palette">
        <h3>⚡ Command Palette</h3>
        <div class="palette-item" data-action="screenshot">
          <span>📸 Take Screenshot</span><span class="palette-shortcut">Shift+F12</span>
        </div>
        <div class="palette-item" data-action="save">
          <span>💾 Save World</span><span class="palette-shortcut">Ctrl+S</span>
        </div>
        <div class="palette-item" data-action="load">
          <span>📁 Load World</span><span class="palette-shortcut">Ctrl+O</span>
        </div>
        <div class="palette-item" data-action="toggle-ui">
          <span>🖥️ Toggle Full UI</span><span class="palette-shortcut">F10</span>
        </div>
        <div class="palette-item" data-action="toggle-hud">
          <span>👁️ Toggle HUD</span><span class="palette-shortcut">F9</span>
        </div>
        <div class="palette-item" data-action="clear-all">
          <span>🗑️ Clear All Objects</span><span class="palette-shortcut">Ctrl+Del</span>
        </div>
        <div class="palette-item" data-action="ai-help">
          <span>🤖 AI Assistant Help</span><span class="palette-shortcut">F1</span>
        </div>
        <div class="palette-item" data-action="toggle-ai-suggestions">
          <span>💡 Toggle AI Suggestions</span><span class="palette-shortcut">F3</span>
        </div>
        <div class="palette-item" data-action="undo">
          <span>↶ Undo</span><span class="palette-shortcut">Ctrl+Z</span>
        </div>
        <div class="palette-item" data-action="redo">
          <span>↷ Redo</span><span class="palette-shortcut">Ctrl+Y</span>
        </div>
      </div>
      <!-- Compact UI Dock -->
      <div id="uiControls">
        <button class="ui-control-btn" id="uiToggleBtn" title="Toggle UI (F10)">🖥️</button>
        <button class="ui-control-btn" id="hudToggleBtn" title="Toggle HUD (F9)">📊</button>
        <button class="ui-control-btn" id="consoleBtn" title="Command Console">⌘</button>
        <button class="ui-control-btn" id="paletteBtn" title="Command Palette (Ctrl+K)">🎨</button>
        <button class="ui-control-btn" id="screenshotBtn" title="Screenshot (Shift+F12)">📷</button>
      </div>
      
      <!-- Preset Picker Modal -->
      <div id="presetPicker">
        <h4 id="presetTitle">Choose Preset</h4>
        <div id="presetOptions"></div>
      </div>
      
      <!-- Toast Container -->
      <div id="toastContainer"></div>
      
      <!-- Diagnostics Panel -->
      <div id="diagnosticsPanel">
        <h4>🔧 Diagnostics</h4>
        <div class="diagnostic-item">FPS: <span id="diagFPS">60</span></div>
        <div class="diagnostic-item">Objects: <span id="diagObjects">0</span></div>
        <div class="diagnostic-item">Triangles: <span id="diagTriangles">0</span></div>
        <div class="diagnostic-item">Memory: <span id="diagMemory">0KB</span></div>
        <div class="diagnostic-item">Preset: <span id="diagPreset">medium</span></div>
        <div class="diagnostic-actions">
          <button class="diagnostic-btn" id="copyDiagnosticsBtn">Copy</button>
          <button class="diagnostic-btn" id="toggleDiagnosticsBtn">Hide</button>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script type="module" src="main.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ChatManager.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ImageGenerator.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ProgressLogger.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/OGP.js"></script>
  </body>
</html>